{"version":3,"file":"../../js/llms-admin-media-protection-block-protect.min.js","sources":["llms-admin-media-protection-block-protect.js"],"sourcesContent":["(()=>{\"use strict\";const e=window.wp.element;!function(t){const{addFilter:r}=t.hooks,{createHigherOrderComponent:l}=t.compose,{Fragment:o,useState:n,useEffect:a,useRef:c,createInterpolateElement:i}=t.element,{ToolbarButton:s,Modal:m,Button:u,Flex:d,FlexItem:p,Notice:h,ExternalLink:E}=t.components,{BlockControls:b}=t.blockEditor,{apiFetch:g}=t,w=[\"core/image\",\"core/video\",\"core/audio\",\"core/file\"],f=e=>{switch(e){case\"core/image\":default:return\"url\";case\"core/audio\":case\"core/video\":return\"src\";case\"core/file\":return\"href\"}};r(\"editor.BlockEdit\",\"my-plugin/with-protect-image-toolbar\",l((t=>r=>{const l=i(LLMS.l10n.translate(\"This media is not protected. If you select a product here, the media will be moved to the protected uploads directory and existing links to the media will no longer work. <link>Learn More</link>\"),{link:(0,e.createElement)(E,{href:\"https://lifterlms.com/docs/how-protected-media-files-work/?utm_source=LifterLMS%20Plugin&utm_medium=Media&utm_campaign=Backend%20Help%20Page\"})});if(!r.attributes||!r.attributes.id)return(0,e.createElement)(t,r);if(!w.includes(r.name))return(0,e.createElement)(t,r);const[_,k]=n(!1),[L,y]=n(null),v=c(null);return a((()=>{_&&v.current&&jQuery(v.current).llmsPostsSelect2()}),[_]),a((()=>{_&&g({path:`/wp/v2/media/${r.attributes.id}?context=edit`}).then((e=>{const t=e._llms_media_protection_product_id;if(!t)return void y(null);const r=[\"courses\",\"memberships\"];(async()=>{for(const e of r)try{const r=await g({path:`/llms/v1/${e}/${t}?context=edit`});return void y(r.title.raw)}catch(e){}y(\"(unknown)\")})()})).catch((e=>{console.error(\"Unable to read media meta\",e),y(null)}))}),[_,r.attributes.id]),(0,e.createElement)(o,null,(0,e.createElement)(t,r),(0,e.createElement)(b,{group:\"inline\"},(0,e.createElement)(s,{icon:\"lock\",label:\"Protect Image\",onClick:()=>k(!0)})),_&&(0,e.createElement)(m,{title:LLMS.l10n.translate(\"Select Course or Membership\"),onRequestClose:()=>k(!1)},(0,e.createElement)(d,{direction:\"column\",gap:4},(0,e.createElement)(p,null,(0,e.createElement)(\"label\",{htmlFor:\"llms-protect-image-select\"},LLMS.l10n.translate(\"Select a Course or Membership to protect this image:\"))),(0,e.createElement)(p,null,!r.attributes[f(r.name)].includes(\"llms_media_id\")&&(0,e.createElement)(h,{status:\"warning\",isDismissible:!1},l),(0,e.createElement)(\"select\",{id:\"llms-protect-image-select\",ref:v,className:\"llms-block-protect llms-posts-select2\",\"data-no-view-button\":\"true\",\"data-allow_clear\":\"false\",\"data-post-type\":\"course,llms_membership\"})),L&&(0,e.createElement)(p,null,LLMS.l10n.translate(\"Currently protected by:\"),\"Â \",(0,e.createElement)(\"strong\",null,L)),(0,e.createElement)(p,null,(0,e.createElement)(u,{isPrimary:!0,onClick:()=>{(()=>{const e=jQuery(v.current).val();g({path:`/wp/v2/media/${r.attributes.id}`,method:\"POST\",data:{_llms_media_protection_product_id:e}}).then((e=>{const t=f(r.name);r.setAttributes({[t]:e.source_url}),y(null)})).catch((e=>{console.error(\"Error updating media meta:\",e)})),k(!1)})()}},\"Protect Image\")))))}),\"withProtectImageToolbar\"))}(window.wp)})();"],"names":["e","window","wp","element","t","r","hooks","addFilter","l","compose","createHigherOrderComponent","Fragment","o","useState","n","useEffect","a","useRef","c","createInterpolateElement","i","ToolbarButton","s","Modal","m","Button","u","Flex","d","FlexItem","p","Notice","h","ExternalLink","E","components","b","blockEditor","BlockControls","g","apiFetch","w","f","LLMS","l10n","translate","link","createElement","href","attributes","id","includes","name","_","k","L","y","v","current","jQuery","llmsPostsSelect2","path","then","_llms_media_protection_product_id","await","title","raw","catch","console","error","group","icon","label","onClick","onRequestClose","direction","gap","htmlFor","status","isDismissible","ref","className","data-no-view-button","data-allow_clear","data-post-type","isPrimary","val","method","data","setAttributes","source_url"],"mappings":"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","sourceRoot":"../../js"}